<%if (session[:user_id]) %>
        <% @user =  User.find(session[:user_id])%>
    <% end %>
    <% if @user %>
      <p><%= @user.user_name%> </p>
    <% else %>
      <p>anonymous</p>
    <% end %>

<% if @user %>
<% @currentuser = @user %>
<%= link_to "Post a new question now", '/posts/new' ,{:class => 'post'}   %>
<% end %>
<% if @user && @user.role == 2 %>
<p>Admin Exclusive Controls </p>
<%= link_to "Show all users", 'users'%>
<% end %>

<%= form_tag posts_path , :method => 'get'  do  %>
<p>
	<%= text_field_tag :search ,  params[:search]%>
	<%= submit_tag "search" ,:name => nil  %>
</p>
<% end %>



<em class="top"><center><h1>TOP questions</h1>
<p >
<table>
  <tr>
  	 <th>Votes</th> 
  	<th> User </th>>
    <th>Post</th>
    <% if @user && @user.role == 2 %><th>Admin Exclusive</th> <% end %>
  </tr>

<% @posts.each do |post| %>
  <tr > <% if post.weight.nil? 
  	               val ="0" 
  	               else 
  	               	val = post.weight.to_s
  	             end %>
  	            <% str = "Votes:" +  val%>
  	            <% if @user %>
    <td><%= link_to str , :controller => "votes", :action => "new" ,:postid => post.id , :votetype => 1  %>&nbsp; </td>
    <% else %>
    <td><%= str %></td>
    <% end %>
    <td> <%= User.find(post.user_id).user_name %></td>
    <% if @user %>
    <td>	<%= link_to post.title ,post %><font id="oblique">(Posted <%= time_ago_in_words(post.created_at) %>  ago)</font><br>
    <% else %>
    <td> <%= post.title%><br>
    <% end %>
    <b>Responses:</b> <% i  = 0%>
    <% @replies.each do |reply|%>
    <% if reply.post_id == post.id %><br>
        
        <% str = "Votes:" + reply.numvotes.to_s ;i =i+1 %>
       <% if @user %>
    	<%= link_to str, :controller => "votes", :action => "new" ,:postid => reply.id , :votetype => 2  %> 
    	<% else %>
    	<%= str %>
    	<% end %>
    	<%= reply.replytext %>
    	
    	<% if i == 3  
    		  break 
    		  end %> 
    <%  end%>
    <% end %>
    <br><br></td>
    <% if @user && @user.role == 2 %><td><%= link_to 'Delete', post, confirm: 'Are you sure?', method: :delete %></td> <% end %>

  </tr>
<% end %>
</table>
</center></em>
<br />


